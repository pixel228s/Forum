@model Forum.Web.Models.BansViewModel
@{
    ViewData["Title"] = "Bans";
}

<h2>Bans</h2>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Id</th>
            <th>UserId</th>
            <th>Reason</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var ban in Model.Bans)
        {
            <tr>
                <td>@ban.Id</td>
                <td>@ban.UserId</td>
                <td>@ban.BanReason</td>
                <td>@ban.CreationDate.ToString("yyyy-MM-dd")</td>
                <td>@(ban.BanEndDate?.ToString("yyyy-MM-dd") ?? "Permanent")</td>
                <td>
                    <button type="button" class="btn btn-sm btn-warning" onclick="openUpdateBanDialog(@ban.Id, '@ban.BanReason', '@ban.BanEndDate?.ToString("yyyy-MM-dd")')">Update</button>
                    <form method="post" asp-action="DeleteBan" asp-controller="Admin" style="display:inline;">
                        <input type="hidden" name="Id" value="@ban.UserId" />
                        <input type="hidden" name="BanId" value="@ban.Id" />
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<nav aria-label="Page navigation">
    <ul class="pagination">
        @if (Model.CurrentPage > 1)
        {
            <li class="page-item">
                <a class="page-link" asp-action="Bans" asp-route-page="@(Model.CurrentPage - 1)">Previous</a>
            </li>
        }

        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                <a class="page-link" asp-action="Bans" asp-route-page="@i">@i</a>
            </li>
        }

        @if (Model.CurrentPage < ViewBag.TotalPages)
        {
            <li class="page-item">
                <a class="page-link" asp-action="Bans" asp-route-page="@(Model.CurrentPage + 1)">Next</a>
            </li>
        }
    </ul>
</nav>

<form id="updateBanForm" method="post" asp-action="UpdateBan" asp-controller="Admin">
    <input type="hidden" id="updateBanId" name="Id" />
    <input type="hidden" id="updateBanUserId" name="UserId" />

    <div class="mb-3">
        <label for="updateBanReason" class="form-label">Ban Reason</label>
        <textarea id="updateBanReason" name="Reason" class="form-control" rows="3" optional></textarea>
    </div>
    <div class="mb-3">
        <label for="updateBanEndDate" class="form-label">Ban End Date</label>
        <input type="date" id="updateBanEndDate" name="EndDate" class="form-control" />
    </div>
    @Html.AntiForgeryToken()
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-warning">Update</button>
        <button type="button" class="btn btn-secondary" onclick="closeUpdateBanDialog()">Cancel</button>
    </div>
</form>

@section Scripts {
    <script>
        function openUpdateBanDialog(id, reason, endDate) {
            document.getElementById('updateBanId').value = id;
            document.getElementById('updateBanReason').value = reason;
            document.getElementById('updateBanEndDate').value = endDate !== "null" ? endDate : "";
            document.getElementById('updateBanDialog').style.display = 'block';
        }

        function closeUpdateBanDialog() {
            document.getElementById('updateBanDialog').style.display = 'none';
            document.getElementById('updateBanForm').reset();
        }
    </script>
}
